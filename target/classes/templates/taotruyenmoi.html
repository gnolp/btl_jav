<!DOCTYPE html>
<html lang="vi">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Tạo Truyện Mới</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="preconnect" href="https://fonts.googleapis.com/">
	<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
	<link href="/bootstrap.min.css" rel="stylesheet">

	<link rel="stylesheet" href="/app.css">
	<title>Demo Truyện</title>
	<meta name="description"
		content="Đọc truyện online, truyện hay. Demo Truyện luôn tổng hợp và cập nhật các chương truyện một cách nhanh nhất.">
	<style>
		.dark-theme {
			background-color: #333 !important;
			color: #fff !important;
		}

		.list-group-itemC img {
			width: 50px;
			height: 50px;
			object-fit: cover;
			border-radius: 4px;
			margin-right: 10px;
		}

		.container {
			display: flex;
			gap: 20px;
			align-items: flex-start;
		}

		.left-section,
		.right-section {
			flex: 1;
			width: 45%;
		}

		.btn1 {
			padding: 10px 15px;
			margin: 5px;
			cursor: pointer;
		}

		.back-button {
			background-color: #f44336;
			color: white;
			border: none;

		}

		.title {
			font-size: 32px;

			color: white;
			padding: 10px;
			border-radius: 5px;
			text-align: center;
			margin-top: 20px;
		}

		.image-upload {
			margin-top: 20px;
		}

		.image-preview {
			margin-top: 10px;
			width: 70%;
			height: 600px;
			border: 1px solid #ccc;

			position: relative;
			overflow: hidden;
		}

		.image-preview img {
			width: 100%;
			height: 100%;
			object-fit: cover;
			position: absolute;
			cursor: grab;
		}

		.input-field {
			width: 100%;
			/* Đảm bảo các trường nhập liệu chiếm hết chiều rộng */
			padding: 8px;
			font-size: 16px;
			margin-bottom: 10px;
			/* Khoảng cách giữa các trường nhập liệu */
			border-radius: 5px;
			border: 1px solid #ccc;
		}

		#storyTitle {
			width: 100%;
			/* Đảm bảo trường tên truyện có chiều rộng đầy đủ */
		}

		.create-button {
			background-color: #4CAF50;
			color: white;
			border: none;
		}

		.cancel-button {
			background-color: #e7e7e7;
			color: black;
			border: none;
		}

		.genre-list {
			display: none;
			margin: 5px 0;
			border: 1px solid #ccc;
			border-radius: 5px;
			max-height: 150px;
			overflow-y: auto;

		}

		.genre-list label {
			display: block;
			padding: 5px 10px;
		}

		label {
			font-size: 18px;
			font-weight: bold;
		}

		.genre-container {
			position: relative;
			margin-bottom: 10px;
		}

		#storyGenres {
			width: 100%;
			padding: 8px;
			font-size: 16px;
			cursor: pointer;
			border-radius: 5px;
			border: 1px solid #ccc;
		}

		.selected-genres {
			margin-top: 5px;
			font-size: 16px;
			color: #555;
		}

		#storyDescription {
			width: 100%;
			/* Đảm bảo khung mô tả chiếm hết chiều rộng */
			height: 200px;
			/* Tăng chiều cao để khung mô tả dài hơn */
			padding: 8px;
			font-size: 16px;
			border-radius: 5px;
			border: 1px solid #ccc;
			resize: vertical;
			/* Cho phép người dùng kéo để thay đổi chiều cao */
		}
	</style>
</head>

<body>
	<header class="header d-none d-lg-block">
		<!-- place navbar here -->
		<nav class="navbar navbar-expand-lg navbar-dark header__navbar p-md-0">
			<div class="container">
				<a class="navbar-brand" href="/">
					<img src="/images/logo.png" alt="Logo Truyen" srcset="" class="img-fluid" style="width: 100px;">
				</a>
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse"
					data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
					aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarSupportedContent">
					<ul class="navbar-nav me-auto mb-2 mb-lg-0">
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
								aria-expanded="false">
								Thể loại
							</a>
							<ul class="dropdown-menu dropdown-menu-custom" id="category-list">
								<li><a class="dropdown-item" href="#" data-category="1">Ngôn Tình</a></li>
								<li><a class="dropdown-item" href="#" data-category="2">Trọng Sinh</a></li>
								<li><a class="dropdown-item" href="#" data-category="3">Cổ Đại</a></li>
								<li><a class="dropdown-item" href="#" data-category="4">Tiên Hiệp</a></li>
								<li><a class="dropdown-item" href="#" data-category="5">Ngược</a></li>
								<li><a class="dropdown-item" href="#" data-category="6">Khác</a></li>
								<li><a class="dropdown-item" href="#" data-category="7">Dị Giới</a></li>
								<li><a class="dropdown-item" href="#" data-category="8">Huyền Huyễn</a></li>
								<li><a class="dropdown-item" href="#" data-category="9">Xuyên Không</a></li>
								<li><a class="dropdown-item" href="#" data-category="10">Sủng</a></li>
								<li><a class="dropdown-item" href="#" data-category="11">Cung Đấu</a></li>
								<li><a class="dropdown-item" href="#" data-category="12">Gia Đấu</a></li>
							</ul>
						</li>
					</ul>



					<div class="form-check form-switch me-3 d-flex align-items-center">
						<label class="form-check-label">
							<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
								class="bi bi-brightness-high" viewBox="0 0 16 16" style="fill: #fff;">
								<path
									d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z">
								</path>
							</svg>
						</label>
						<input class="form-check-input theme_mode" type="checkbox"
							style="transform: scale(1.3); margin-left: 12px; margin-right: 12px;">

						<label class="form-check-label">
							<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 384 512"
								style="fill: #fff;">
								<path
									d="M144.7 98.7c-21 34.1-33.1 74.3-33.1 117.3c0 98 62.8 181.4 150.4 211.7c-12.4 2.8-25.3 4.3-38.6 4.3C126.6 432 48 353.3 48 256c0-68.9 39.4-128.4 96.8-157.3zm62.1-66C91.1 41.2 0 137.9 0 256C0 379.7 100 480 223.5 480c47.8 0 92-15 128.4-40.6c1.9-1.3 3.7-2.7 5.5-4c4.8-3.6 9.4-7.4 13.9-11.4c2.7-2.4 5.3-4.8 7.9-7.3c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-3.7 .6-7.4 1.2-11.1 1.6c-5 .5-10.1 .9-15.3 1c-1.2 0-2.5 0-3.7 0c-.1 0-.2 0-.3 0c-96.8-.2-175.2-78.9-175.2-176c0-54.8 24.9-103.7 64.1-136c1-.9 2.1-1.7 3.2-2.6c4-3.2 8.2-6.2 12.5-9c3.1-2 6.3-4 9.6-5.8c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-3.6-.3-7.1-.5-10.7-.6c-2.7-.1-5.5-.1-8.2-.1c-3.3 0-6.5 .1-9.8 .2c-2.3 .1-4.6 .2-6.9 .4z">
								</path>
							</svg>
						</label>
					</div>

					<form class="d-flex header__form-search" action="" method="GET">
						<input class="form-control search-story" type="text" placeholder="Tìm kiếm" name="key_word"
							value="">
						<div class="col-12 search-result shadow no-result d-none">
							<div class="card text-white bg-light">
								<div class="card-body p-0">
									<ul class="list-group list-group-flush d-none">
										<li class="list-group-item">
											<a href="#" class="text-dark hover-title"></a>
										</li>
									</ul>
								</div>
							</div>
						</div>

						<button class="btn" type="submit">
							<svg xmlns="http://www.w3.org/2000/svg" height="1em"
								viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
								<path
									d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z">
								</path>
							</svg>

						</button>
					</form>
					<script>
						document.querySelector('.search-story').addEventListener('input', async (e) => {
							const keyword = e.target.value;

							if (keyword.trim().length === 0) {
								hideSearchResult();
								return;
							}

							try {
								const response = await fetch(`/search-stories?keyword=${encodeURIComponent(keyword)}`);
								const stories = await response.json();

								if (stories.length > 0) {
									showSearchResult(stories);
								} else {
									showNoResult();
								}
							} catch (error) {
								console.error('Lỗi khi tìm kiếm:', error);
							}
						});

						function showSearchResult(stories) {
							const resultContainer = document.querySelector('.search-result');
							resultContainer.classList.remove('d-none');
							const listGroup = resultContainer.querySelector('.list-group');
							listGroup.classList.remove('d-none');
							listGroup.innerHTML = '';

							stories.forEach((story) => {
								// Tạo thẻ item
								const item = document.createElement('li');
								item.className = 'list-group-itemC d-flex align-items-center';
								item.setAttribute('data-id', story.id);

								// Tạo thẻ img
								const img = document.createElement('img');
								img.src = story.srcA;
								img.alt = story.title;
								img.className = 'me-2';

								// Tạo thẻ link
								const link = document.createElement('a');
								link.href = '#';
								link.textContent = story.title;
								link.className = 'text-dark hover-title';


								link.addEventListener('click', async (e) => {
									e.preventDefault();
									console.log(`Truyện được chọn: ${story.title}`);

									try {
										const response = await fetch(`/story/${story.id}`);
										const data = await response.json();
										console.log('Dữ liệu chi tiết:', data);

										localStorage.setItem('data', JSON.stringify(data));
										window.location.href = '/story-details';
									} catch (error) {
										console.error('Lỗi khi lấy chi tiết truyện:', error);
									}
								});

								item.appendChild(img);
								item.appendChild(link);

								// Gắn item vào danh sách
								listGroup.appendChild(item);
							});
						}

						function showNoResult() {
							const resultContainer = document.querySelector('.search-result');
							resultContainer.classList.remove('d-none'); // Hiển thị container
							const listGroup = resultContainer.querySelector('.list-group');
							listGroup.classList.remove('d-none');
							listGroup.innerHTML = '';
							const item = document.createElement('span');
							item.style.color = 'black';
							item.textContent = 'Không tìm thấy kết quả';


							listGroup.appendChild(item);
						}

						function hideSearchResult() {
							const resultContainer = document.querySelector('.search-result');
							resultContainer.classList.add('d-none'); // Ẩn container
						}
					</script>
					<li style="float:right;">
						<span th:if="${session.user == null}">
							<a href="/login" class="login-button"
								style="display: inline-block; padding: 10px 20px; background-color: #007BFF; color: white; text-decoration: none; border-radius: 5px; margin-left: 10px;">Đăng
								nhập</a>
						</span>
						<span th:if="${session.user != null}">
							<a th:href="@{/account(userId=${session.userId})}" class="welcome-button">Chào mừng, <span
									th:text="${session.user.firstName}"></span></a>
							<a href="/logout" class="logout-button"
								style="display: inline-block; padding: 10px 20px; background-color: #DC3545; color: white; text-decoration: none; border-radius: 5px; margin-left: 10px;">Đăng
								xuất</a>
						</span>
					</li>
				</div>
			</div>
		</nav>
	</header>

	<div class="header-mobile d-sm-block d-lg-none">
		<nav class="navbar navbar-dark bg-dark">
			<div class="container-fluid">
				<a class="navbar-brand" href="/">
					<img src="/images/logo.png" alt="Logo Truyen" srcset="" class="img-fluid" style="width: 100px;">
				</a>
				<button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
					data-bs-target="#offcanvasDarkNavbar" aria-controls="offcanvasDarkNavbar">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="offcanvas offcanvas-end text-bg-dark w-75" tabindex="-1" id="offcanvasDarkNavbar"
					aria-labelledby="offcanvasDarkNavbarLabel">
					<div class="offcanvas-header">
						<img src="/images/logo.png" alt="Logo Truyen" srcset="" class="img-fluid" style="width: 100px;">
						<button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"
							aria-label="Close"></button>
					</div>
					<div class="offcanvas-body">
						<ul class="navbar-nav justify-content-end flex-grow-1 pe-3 mb-3">
							<li class="nav-item dropdown">
								<a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
									aria-expanded="false">
									Thể loại
								</a>
								<ul class="dropdown-menu dropdown-menu-custom">
									<li><a class="dropdown-item" data-category="13" href="#">Mạt Thế</a></li>
									<li><a class="dropdown-item" data-category="14" href="#">Xuyên Nhanh</a></li>
									<li><a class="dropdown-item" data-category="15" href="#">Hệ Thống</a></li>
									<li><a class="dropdown-item" data-category="16" href="#">Nữ Cường</a></li>
								</ul>
							</li>
							<script>


								document.querySelectorAll('.dropdown-item').forEach(item => {
									item.addEventListener('click', async function (event) {  // Thêm 'async' ở đây
										event.preventDefault();  // Ngăn chặn hành động mặc định của thẻ <a>

										const category = this.getAttribute('data-category');  // Lấy thể loại từ thuộc tính data-category

										console.log("category:", category);

										// Fetch dữ liệu truyện từ backend
										try {
											const response = await fetch(`/stories/${category}`);  // Thêm dấu backticks
											const data = await response.json();

											if (data) {
												localStorage.setItem('stories', JSON.stringify(data.stories));
												localStorage.setItem('idtl', JSON.stringify(data.idtl));
												localStorage.setItem('TheLoai', JSON.stringify(data.TheLoai));
												console.log(data);

												window.location.href = '/category';

											}
										} catch (error) {
											console.error("Error fetching stories:", error);
										}
									});
								});

							</script>
						</ul>

						<div class="form-check form-switch d-flex align-items-center mb-3 p-0">
							<label class="form-check-label">
								<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
									class="bi bi-brightness-high" viewBox="0 0 16 16" style="fill: #fff;">
									<path
										d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z">
									</path>
								</svg>
							</label>
							<input class="form-check-input theme_mode" type="checkbox"
								style="transform: scale(1.3); margin-left: 12px; margin-right: 12px;">

							<label class="form-check-label">
								<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 384 512"
									style="fill: #fff;">
									<path
										d="M144.7 98.7c-21 34.1-33.1 74.3-33.1 117.3c0 98 62.8 181.4 150.4 211.7c-12.4 2.8-25.3 4.3-38.6 4.3C126.6 432 48 353.3 48 256c0-68.9 39.4-128.4 96.8-157.3zm62.1-66C91.1 41.2 0 137.9 0 256C0 379.7 100 480 223.5 480c47.8 0 92-15 128.4-40.6c1.9-1.3 3.7-2.7 5.5-4c4.8-3.6 9.4-7.4 13.9-11.4c2.7-2.4 5.3-4.8 7.9-7.3c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-3.7 .6-7.4 1.2-11.1 1.6c-5 .5-10.1 .9-15.3 1c-1.2 0-2.5 0-3.7 0c-.1 0-.2 0-.3 0c-96.8-.2-175.2-78.9-175.2-176c0-54.8 24.9-103.7 64.1-136c1-.9 2.1-1.7 3.2-2.6c4-3.2 8.2-6.2 12.5-9c3.1-2 6.3-4 9.6-5.8c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-3.6-.3-7.1-.5-10.7-.6c-2.7-.1-5.5-.1-8.2-.1c-3.3 0-6.5 .1-9.8 .2c-2.3 .1-4.6 .2-6.9 .4z">
									</path>
								</svg>
							</label>
						</div>

						<form class="d-flex header__form-search" action="" method="GET">
							<input class="form-control search-story" type="text" placeholder="Tìm kiếm" name="key_word"
								value="">
							<div class="col-12 search-result shadow no-result d-none">
								<div class="card text-white bg-light">
									<div class="card-body p-0">
										<ul class="list-group list-group-flush d-none">
											<li class="list-group-item">
												<a href="#" class="text-dark hover-title"></a>
											</li>
										</ul>
									</div>
								</div>
							</div>

							<button class="btn" type="submit">
								<svg xmlns="http://www.w3.org/2000/svg" height="1em"
									viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
									<path
										d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z">
									</path>
								</svg>

							</button>
						</form>
						<script>
							document.querySelector('.search-story').addEventListener('input', async (e) => {
								const keyword = e.target.value;

								if (keyword.trim().length === 0) {
									hideSearchResult();
									return;
								}

								try {
									const response = await fetch(`/search-stories?keyword=${encodeURIComponent(keyword)}`);
									const stories = await response.json();

									if (stories.length > 0) {
										showSearchResult(stories);
									} else {
										showNoResult();
									}
								} catch (error) {
									console.error('Lỗi khi tìm kiếm:', error);
								}
							});

							function showSearchResult(stories) {
								const resultContainer = document.querySelector('.search-result');
								resultContainer.classList.remove('d-none');
								const listGroup = resultContainer.querySelector('.list-group');
								listGroup.classList.remove('d-none');
								listGroup.innerHTML = '';

								stories.forEach((story) => {
									// Tạo thẻ item
									const item = document.createElement('li');
									item.className = 'list-group-itemC d-flex align-items-center';
									item.setAttribute('data-id', story.id);

									// Tạo thẻ img
									const img = document.createElement('img');
									img.src = story.srcA;
									img.alt = story.title;
									img.className = 'me-2';

									// Tạo thẻ link
									const link = document.createElement('a');
									link.href = '#';
									link.textContent = story.title;
									link.className = 'text-dark hover-title';


									link.addEventListener('click', async (e) => {
										e.preventDefault();
										console.log(`Truyện được chọn: ${story.title}`);

										try {
											const response = await fetch(`/story/${story.id}`);
											const data = await response.json();
											console.log('Dữ liệu chi tiết:', data);

											localStorage.setItem('data', JSON.stringify(data));
											window.location.href = '/story-details';
										} catch (error) {
											console.error('Lỗi khi lấy chi tiết truyện:', error);
										}
									});

									item.appendChild(img);
									item.appendChild(link);

									// Gắn item vào danh sách
									listGroup.appendChild(item);
								});
							}

							function showNoResult() {
								const resultContainer = document.querySelector('.search-result');
								resultContainer.classList.remove('d-none'); // Hiển thị container
								const listGroup = resultContainer.querySelector('.list-group');
								listGroup.classList.remove('d-none');
								listGroup.innerHTML = '';
								const item = document.createElement('span');
								item.style.color = 'black';
								item.textContent = 'Không tìm thấy kết quả';


								listGroup.appendChild(item);
							}

							function hideSearchResult() {
								const resultContainer = document.querySelector('.search-result');
								resultContainer.classList.add('d-none'); // Ẩn container
							}
						</script>
						<ul class="offcanvas-login" style="float: left;">
							<li style="float:right; list-style-type: none;">
								<span th:if="${session.user == null}">
									<a href="/login" class="login-button"
										style="display: inline-block; padding: 10px 20px; background-color: #007BFF; color: white; text-decoration: none; border-radius: 5px; margin-left: 10px;">Đăng
										nhập</a>
								</span>
								<span th:if="${session.user != null}">
									<a href="/account" class="welcome-button">Chào mừng, <span
											th:text="${session.user.firstName}"></span></a>
									<a href="/logout" class="logout-button"
										style="display: inline-block; padding: 10px 20px; background-color: #DC3545; color: white; text-decoration: none; border-radius: 5px; margin-left: 10px;">Đăng
										xuất</a>
								</span>
							</li>
						</ul>

					</div>

				</div>
			</div>
		</nav>
	</div>

	<div class="bg-light header-bottom">
		<div class="container py-1">
			<p class="mb-0">Đọc truyện online, đọc truyện chữ, truyện full, truyện hay. Tổng hợp đầy đủ và cập nhật liên
				tục.</p>
		</div>
	</div>
	</header>
	<div class="header-bottom">
		<h2 class="title">Tạo Truyện Mới</h2>
		<button class="btn back-button" onclick="goBack()">Quay lại</button>
	</div>



	<div class="container">
		<div class="left-section">
			<div class="image-upload">
				<label for="storyImage">Tải lên ảnh truyện:</label>
				<input type="file" id="storyImage" accept="image/*" onchange="previewImage(event)"><br><br>
			</div>
			<div class="image-preview" id="imagePreview">
				<img id="uploadedImage" style="display: none;">
			</div>
		</div>

		<div class="right-section">
			<label for="storyTitle">Tên truyện:</label>
			<input type="text" id="storyTitle" class="input-field" placeholder="Nhập tên truyện"><br><br>

			<div class="genre-container">
				<label for="storyGenres">Thể loại:</label>
				<input type="text" id="storyGenres" class="input-field" placeholder="Chọn thể loại"
					onclick="toggleGenreList()" readonly>
				<div class="genre-list" id="genreList">
					<label><input type="checkbox" value="Ngôn Tình" onclick="updateGenreSelection()"> Ngôn Tình</label>
					<label><input type="checkbox" value="Trọng Sinh" onclick="updateGenreSelection()"> Trọng
						Sinh</label>
					<label><input type="checkbox" value="Cổ Đại" onclick="updateGenreSelection()"> Cổ Đại</label>
					<label><input type="checkbox" value="Tiên Hiệp" onclick="updateGenreSelection()"> Tiên Hiệp</label>
					<label><input type="checkbox" value="Ngược" onclick="updateGenreSelection()"> Ngược</label>
					<label><input type="checkbox" value="Khác" onclick="updateGenreSelection()">Khác</label>
					<label><input type="checkbox" value="Dị Giới" onclick="updateGenreSelection()"> Dị Giới</label>
					<label><input type="checkbox" value="Huyền Huyễn" onclick="updateGenreSelection()"> Huyền
						Huyễn</label>
					<label><input type="checkbox" value="Sủng" onclick="updateGenreSelection()"> Sủng</label>
					<label><input type="checkbox" value="Cung Đấu" onclick="updateGenreSelection()"> Cung Đấu</label>
					<label><input type="checkbox" value="Gia Đấu" onclick="updateGenreSelection()">Gia Đấu</label>
					<label><input type="checkbox" value="Xuyên Không" onclick="updateGenreSelection()">Xuyên
						Không</label>
				</div>
				<div id="selectedGenres" class="selected-genres"></div>
			</div><br>

			<label for="storyDescription">Mô tả:</label><br>
			<textarea id="storyDescription" class="input-field" rows="4" placeholder="Nhập mô tả"></textarea><br><br>

			<button class="btn create-button" onclick="createStory()">Tạo</button>
			<button class="btn cancel-button" onclick="cancel()">Hủy</button>
		</div>
	</div>

	<script>
		function goBack() {
			window.history.back();
		}

		function toggleGenreList() {
			const genreList = document.getElementById('genreList');
			genreList.style.display = genreList.style.display === 'none' || genreList.style.display === '' ? 'block' : 'none';
		}

		function updateGenreSelection() {
			const genreInputs = document.querySelectorAll('.genre-list input[type="checkbox"]');
			const selectedGenres = [];

			genreInputs.forEach(input => {
				if (input.checked) {
					selectedGenres.push(input.value);
				}
			});

			const selectedGenresText = selectedGenres.join(', ');
			const selectedGenresElement = document.getElementById('selectedGenres');

			if (selectedGenresText) {
				selectedGenresElement.textContent = selectedGenresText;
				document.getElementById('storyGenres').value = selectedGenresText;
				selectedGenresElement.style.display = 'block';
			} else {
				selectedGenresElement.style.display = 'none';
			}
		}

		document.addEventListener('click', function (e) {
			const genreList = document.getElementById('genreList');
			const storyGenres = document.getElementById('storyGenres');
			const selectedGenresElement = document.getElementById('selectedGenres');

			if (!storyGenres.contains(e.target) && !genreList.contains(e.target)) {
				genreList.style.display = 'none';
				selectedGenresElement.style.display = 'none';
			}
		});

		function previewImage(event) {
			const imagePreview = document.getElementById('imagePreview');
			const img = document.getElementById('uploadedImage');
			const file = event.target.files[0];

			if (file) {
				const reader = new FileReader();
				reader.onload = function (e) {
					img.src = e.target.result;
					img.style.display = 'block';
					img.style.transform = 'scale(1)';
					img.dataset.scale = 1;
					img.style.left = '0px';
					img.style.top = '0px';

					let isDragging = false;
					let startX, startY;

					img.addEventListener('mousedown', (e) => {
						isDragging = true;
						startX = e.clientX - img.offsetLeft;
						startY = e.clientY - img.offsetTop;
						img.style.cursor = 'grabbing';
					});

					window.addEventListener('mousemove', (e) => {
						if (isDragging) {
							img.style.left = `${e.clientX - startX}px`;
							img.style.top = `${e.clientY - startY}px`;
						}
					});

					window.addEventListener('mouseup', () => {
						isDragging = false;
						img.style.cursor = 'grab';
					});

					img.addEventListener('wheel', (e) => {
						e.preventDefault();
						let scale = parseFloat(img.dataset.scale);
						const delta = e.deltaY > 0 ? -0.1 : 0.1;
						scale = Math.max(0.5, Math.min(3, scale + delta));
						img.style.transform = `scale(${scale})`;
						img.dataset.scale = scale;
					});
				}
				reader.readAsDataURL(file);
			} else {
				//imagePreview.innerHTML = 'Chưa có hình ảnh nào được tải lên.';
			}
		}


		function cancel() {
			if (confirm("Bạn có chắc chắn muốn hủy không?")) {
				window.location.reload();
			}
		}

		function createStory() {
			// Lấy tên truyện
			const title = document.getElementById("storyTitle").value;

			// Lấy mô tả
			const description = document.getElementById("storyDescription").value;

			// Lấy thể loại đã chọn
			const selectedGenres = [];
			const checkboxes = document.querySelectorAll("#genreList input[type='checkbox']");
			checkboxes.forEach((checkbox) => {
				if (checkbox.checked) {
					selectedGenres.push(checkbox.value);
				}
			});

			// Lấy hình ảnh (nếu người dùng đã tải lên ảnh mới)
			const img = document.getElementById("uploadedImage");
			const imageSrc = img.src.startsWith("data:") ? img.src : "/images/logo.png";  // Sửa lỗi này

			// Lấy author_id từ Thymeleaf hoặc từ một giá trị JavaScript đã có sẵn
			const author_id = [[${ session.userId }]];

			// Tạo đối tượng dữ liệu để gửi về backend
			const data1 = {
				title: title,
				genres: selectedGenres.join(", "), // Ghép các thể loại thành chuỗi
				description: description,
				image: imageSrc,
				author_id: author_id,
			};

			console.log("data1: ", data1);  // In ra để kiểm tra dữ liệu

			// Gửi dữ liệu tới backend bằng fetch API
			fetch("/tao-truyen", {
				method: "POST",
				headers: {
					"Content-Type": "application/json",
				},
				body: JSON.stringify(data1),
			})
				.then((response) => response.text())
				.then((result) => {
					if (result === "true") {
						alert("Đã tạo thành công!");
					} else {
						alert("Có lỗi xảy ra!");
					}
				})
				.catch((error) => {
					console.error("Lỗi khi gửi yêu cầu:", error);
					alert("Không thể lưu thay đổi. Vui lòng thử lại!");
				});
		}

		function cancel() {
			if (confirm("Bạn có chắc chắn muốn hủy không?")) {
				window.location.reload();
			}
		}



	</script>
	<script src="/jquery.min.js"></script>
	<script src="/popper.min.js"></script>
	<script src="/bootstrap.min.js"></script>
	<script src="/app.js"></script>
	<script src="/common.js"></script>

	<div id="loadingPage" class="loading-full">
		<div class="loading-full_icon">
			<div class="spinner-grow"><span class="visually-hidden">Loading...</span></div>
		</div>
	</div>
</body>

</html>